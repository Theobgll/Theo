<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Admin – Live Camera</title>
</head>
<body>

<h2>Caméra utilisateur (temps réel)</h2>
<video id="remoteVideo" autoplay playsinline></video>

<script>
  const video = document.getElementById('remoteVideo');

  const socket = new WebSocket('wss://theo-bgll-github-io.onrender.com');

  let pc = new RTCPeerConnection();

  socket.onopen = () => {
    console.log("WebSocket connecté (admin)");
    socket.send(JSON.stringify({ type: 'ready' }));
  };

  socket.onmessage = async (msg) => {
    console.log("message reçu admin:", msg.data);

    const data = JSON.parse(msg.data);

    if (data.type === 'offer') {
      await pc.setRemoteDescription(data.offer);

      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);

      socket.send(JSON.stringify({ type: 'answer', answer }));
      console.log("answer envoyé");
    }

    if (data.type === 'candidate') {
      await pc.addIceCandidate(data.candidate);
      console.log("candidate ajouté admin");
    }
  };

  socket.onclose = () => console.log("WebSocket fermé (admin)");
  socket.onerror = (e) => console.log("Erreur WebSocket (admin)", e);

  pc.ontrack = (event) => {
    video.srcObject = event.streams[0];
  };

  pc.onicecandidate = (e) => {
    if (e.candidate) {
      socket.send(JSON.stringify({ type:'candidate', candidate:e.candidate }));
    }
  };
</script>

</body>
</html>
